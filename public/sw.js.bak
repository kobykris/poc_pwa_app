self.addEventListener('push', function(event) {
  console.log('[SW] Push Received:', event.data.text());
  const data = event.data?.json() || { title: 'No Title', body: 'No Body' };
  
  const options = {
    body: data.body,
    icon: data.icon || '/pwa-192x192.png',
    badge: data.badge || '/pwa-192x192.png',
    vibrate: [200, 100, 200],
    data: {
      dateOfArrival: Date.now(),
      id: 1
    },
    actions: [
      { action: 'view', title: 'View' },
      { action: 'close', title: 'Close' },
    ]
  };

  event.waitUntil(
    self.registration.showNotification(data.title, options).then( () => console.log('[SW] Notification displayed') )
  );
});

self.addEventListener('notificationclick', function(event) {
  console.log('[SW] Notification clicked:', event.action);
  event.notification.close();

  if (event.action === 'view') {
    event.waitUntil(
      clients.openWindow('/')
    );
  }
});